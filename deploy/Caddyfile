{
  email {$ACME_EMAIL}
}

{$APP_HOST} {
  root * /srv/app
  encode zstd gzip

  @sw path /flutter_service_worker.js /flutter_bootstrap.js /firebase-messaging-sw.js
  header @sw Cache-Control "no-cache, no-store, must-revalidate"
  
  # SPA routing: serve index.html for all non-file requests
  try_files {path} /index.html
  file_server
  
  header {
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    Referrer-Policy "strict-origin-when-cross-origin"
  }
}

{$API_HOST} {
  reverse_proxy backend:8080
  encode zstd gzip
  header {
    X-Content-Type-Options "nosniff"
  }
}
